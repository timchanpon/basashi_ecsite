{% extends 'base.html' %}
{% load static %}

{% block title %}商品一覧{% endblock %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/post_list.css' %}">
{% endblock %}

{% block contents %}
<div id="post-list">
  {% if post_list %}
    <div class="post-card-container">
      {% for post in post_list %}
        <post-card-component
          part-name="{{ post.part_name }}"
          details="{{ post.details }}"
          img-url="{{ post.image.url }}"
          price="{{ post.price }}"
          num-grams="{{ post.num_grams }}"
          stock-amt="{{ post.stock_amt }}"
        ></post-card-component>
      {% endfor %}
    </div>
  {% else %}
    <p>まだ商品がありません。</p>
  {% endif %}
</div>
{% endblock %}

{% block script %}
<script type="text/x-template" id="post-card-component">
  <section>
  <div class="post-card">
    <p class="post-card-link" @click="openPostCardModal"></p>
    <div class="post-card-img">
      <img :src="imgUrl">
    </div>
    <div class="post-card-btm-section">
      <h3 class="post-card-post-name">[[ partName ]] [[ numGrams ]]g</h3>
      <div class="post-card-meta-section">
        <p class="post-card-price">[[ price ]]円</p>
        <p class="post-card-stock-amt">残り：[[ stockAmt ]]個</p>
      </div>
    </div>
  </div>

  <div class="post-card-modal-overlay" v-if="isShowPCM" @click="closePostCardModal"></div>
  <div class="post-card-modal" v-if="isShowPCM">
    <div class="post-card-modal-img">
      <img :src="imgUrl">
    </div>
    <p class="post-card-modal-details" v-if="details==''">これは、[[ partName ]][[ numGrams ]]gです。</p>
    <p class="post-card-modal-details" v-else>[[ details ]]</p>
    <a class="post-card-modal-link" href="#">商品詳細ページ</a>
  </div>
  </section>
</script>

<script>
  var PostCardComponent = {
    template: '#post-card-component',
    props: {
      partName: String,
      details: String,
      imgUrl: String,
      price: Number,
      numGrams: Number,
      stockAmt: Number,
    },
    data: function() {
      return {
        isShowPCM: false,
      }
    },
    methods: {
      openPostCardModal: function() {
        this.isShowPCM = true
      },
      closePostCardModal: function() {
        this.isShowPCM = false
      },
    },
    delimiters: ['[[', ']]'],
  }

  new Vue({
    el: '#post-list',
    components: {
      'post-card-component': PostCardComponent,
    },
  })
</script>
{% endblock %}
